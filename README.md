
## OCI-RSA-ANSIBLE-ODFE
This stack contains the [Wazuh](https://wazuh.com/) cluster elastic search playbook, which automates the deployment and configuration of [Open Distro for Elasticsearch](https://opendistro.github.io/for-elasticsearch/) (ODFE)  in a 3 node cluster.

## Ansible Role: wazuh-odfe
Detailed information on the wazuh-odfe role and role variables can be found [here](/wazuh-odfe/README.md). 

## Ansible Role: wazuh-ansible
We are using <b>Galaxy</b> which provides pre-packaged units of work known to Ansible as roles and collections. Content 
from roles and collections of the <b>wazuh-ansible</b> are referenced in oci-rsa-ansible-wazuh-odfe. This playbook installs and 
configures Wazuh agent and manager.

## Ansible Role: oci-rsa-ansible-Base
Detailed information on the oci-rsa-ansible-base can be found [here]().

## Requirements
- [Ansible core](https://docs.ansible.com/ansible-core/devel/index.html) >= 2.11.0
- Oracle Linux >= 7.9

## Dependencies

A list of other roles hosted on Galaxy:

* [geerlingguy.clamav](https://github.com/geerlingguy/ansible-role-clamav): Installs ClamAV on Linux server.
* [wazuh-ansible](https://github.com/wazuh/wazuh-ansible): These playbooks install and configure Wazuh agent, manager and Elastic Stack
    - [wazuh-opendistro-elasticsearch](https://github.com/wazuh/wazuh-ansible/tree/master/roles/opendistro/opendistro-elasticsearch) An Ansible Role that installs Open Distro for Elasticsearch.

A list of other roles hosted on Github:
* [oci-rsa-ansible-base](pending...): Installs base packages and sets configuration for general security, montoring, and auditing purposes.

## Branches

* `main` branch contains the latest code.

## Usage

To run this playbook, this repository needs to be bundled up with the required collections and roles and uploaded to an object storage bucket as a tgz file.

Assuming you have cloned the repo and are in the repository root:

Command to install the ansible roles
```
ansible-galaxy install --ignore-certs -r requirements.yml -p ./.galaxy-roles
```
Command to install the ansible collections
```
ansible-galaxy collection install --ignore-certs -r requirements.yml -p ./.galaxy-collections
```
Command to bundle up the playbook.
Here the `playbook_zip` is `target_dir/playbook_name`
```
tar -czf $playbook_zip $playbook_name
```
Command to upload the tar file to object storage
```
oci os object put -ns $namespace -bn $bucketname --file $playbook_zip --name ${playbook_name}.tgz
```

After terraform provisions the instance, the bootstrapping script pulls the appropriate tar file from object store and runs the playbook.

Becuase we are not using ansible inventory to run the playbooks, the bootstrapping script runs the following command to launch the playbook directly on each of the hosts locally.

```
ansible-playbook -i localhost, $OCI_RSA_BASE/${playbook_name}/main.yml --connection=local
```

An `extra_variables.yml` file is required to set the following variables. These values are randomly generated by terraform and sent to the instances during bootstrapping. These can be overwritten by the user.
```
opendistro_admin_password: "${}"
opendistro_kibana_password: "${}"
```
## Documentation

* [Wazuh Ansible documentation](https://documentation.wazuh.com/current/deploying-with-ansible/index.html)
* [Full documentation](http://documentation.wazuh.com)

## How to Contribute
Interested in contributing?  See our contribution [guidelines](CONTRIBUTE.md) for details.

## License
This repository and its contents are licensed under [UPL 1.0](LICENSE).    

